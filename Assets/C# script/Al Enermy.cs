using UnityEngine;

public class EnemyChase : MonoBehaviour
{
    public float speed = 3f;             // ???????????????????
    public float detectionRange = 5f;   // ????????????????????????????
    public float stopRange = 1f;        // ????????????????????? (??????????)
    private Transform player;           // ?????????????????
    private Rigidbody2D rb;             // Rigidbody2D ????????
    private Animator animator;          // Animator ???????????????????

    void Start()
    {
        rb = GetComponent<Rigidbody2D>();
        animator = GetComponent<Animator>();
        player = GameObject.FindGameObjectWithTag("Player").transform; // ????? GameObject ????????????????? "Player"
    }

    void Update()
    {
        float distanceToPlayer = Vector2.Distance(transform.position, player.position);

        if (distanceToPlayer < detectionRange && distanceToPlayer > stopRange)
        {
            ChasePlayer(); // ?????????????
        }
        else if (distanceToPlayer <= stopRange)
        {
            StopAndAttack(); // ???????????????????
        }
        else
        {
            StopMoving(); // ????????????????????????
        }
    }

    void ChasePlayer()
    {
        // ???????????????????????????????
        Vector2 direction = (player.position - transform.position).normalized;

        // ?????????????????????????
        rb.linearVelocity = new Vector2(direction.x * speed, rb.linearVelocity.y);

        // ??????????????????????????????????????????
        if (direction.x > 0)
            transform.localScale = new Vector3(1, 1, 1);
        else
            transform.localScale = new Vector3(-1, 1, 1);

        // ????????????????????
        if (animator != null)
            animator.SetBool("isWalking", true);
    }

    void StopAndAttack()
    {
        rb.linearVelocity = Vector2.zero; // ??????????????

        // ?????????????????????
        if (animator != null)
            animator.SetTrigger("Attack");
    }

    void StopMoving()
    {
        rb.linearVelocity = Vector2.zero; // ?????????????????

        // ????????????????
        if (animator != null)
            animator.SetBool("isWalking", false);
    }

    private void OnDrawGizmos()
    {
        // ???????????????????????????? Scene View
        Gizmos.color = Color.yellow;
        Gizmos.DrawWireSphere(transform.position, detectionRange);

        Gizmos.color = Color.red;
        Gizmos.DrawWireSphere(transform.position, stopRange);
    }
}
